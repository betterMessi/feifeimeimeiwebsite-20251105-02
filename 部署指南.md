# 部署指南 - 免费方案

本文档介绍如何免费部署照片视频共享系统。

## 📋 免费部署方案

### 方案一：Railway（推荐，最简单）

**优点**：
- 免费额度：$5/月（足够小型应用）
- 自动部署，支持Git
- 内置PostgreSQL（可选）
- 简单易用

**步骤**：

1. **注册Railway账号**
   - 访问 https://railway.app
   - 使用GitHub账号登录

2. **部署后端**
   - 在Railway创建新项目
   - 连接GitHub仓库
   - 选择 `backend` 目录
   - Railway会自动检测Node.js项目并部署
   - 设置环境变量（如果需要）

3. **部署前端**
   - 创建新服务，选择 `样式预览` 目录
   - 或使用Vercel/Netlify部署前端（见方案二）

### 方案二：Vercel + Render（推荐，免费额度大）

**优点**：
- Vercel：前端免费，无限流量
- Render：后端免费额度充足
- 性能好

#### 步骤1：部署前端到Vercel

1. **注册Vercel账号**
   - 访问 https://vercel.com
   - 使用GitHub账号登录

2. **部署前端**
   ```bash
   # 安装Vercel CLI
   npm i -g vercel
   
   # 在样式预览目录下
   cd 样式预览
   vercel
   ```

   或者直接在Vercel网站：
   - 点击 "New Project"
   - 导入GitHub仓库
   - 选择 `样式预览` 目录
   - 框架选择 "Other"
   - 点击 "Deploy"

3. **配置环境变量**
   - 在Vercel项目设置中添加：
     ```
     VITE_API_BASE_URL=https://your-backend-url.onrender.com/api
     ```

#### 步骤2：部署后端到Render

1. **注册Render账号**
   - 访问 https://render.com
   - 使用GitHub账号登录

2. **创建Web服务**
   - 点击 "New" → "Web Service"
   - 连接GitHub仓库
   - 选择 `backend` 目录
   - 配置：
     - **Name**: photo-sharing-backend
     - **Environment**: Node
     - **Build Command**: `npm install`
     - **Start Command**: `npm start`
     - **Plan**: Free

3. **环境变量**（如果需要）
   - 在Render项目设置中添加环境变量

4. **获取后端URL**
   - 部署完成后，Render会提供一个URL，如：`https://photo-sharing-backend.onrender.com`

5. **更新前端API地址**
   - 在Vercel中更新环境变量 `VITE_API_BASE_URL`

### 方案三：本地服务器 + 内网穿透（完全免费）

如果只是临时测试，可以使用内网穿透工具。

#### 使用ngrok（免费）

1. **安装ngrok**
   ```bash
   # 下载ngrok
   # Windows: 下载 https://ngrok.com/download
   # 或使用npm: npm install -g ngrok
   ```

2. **启动后端**
   ```bash
   cd backend
   npm install
   npm start
   ```

3. **启动ngrok**
   ```bash
   ngrok http 3000
   ```

4. **获取公网URL**
   - ngrok会提供一个URL，如：`https://abc123.ngrok.io`
   - 更新前端的API地址

#### 使用Cloudflare Tunnel（免费，不限流量）

1. **安装cloudflared**
   ```bash
   # 下载: https://developers.cloudflare.com/cloudflare-one/connections/connect-apps/install-and-setup/installation/
   ```

2. **创建隧道**
   ```bash
   cloudflared tunnel --url http://localhost:3000
   ```

## 🚀 本地部署步骤

### 1. 安装依赖

```bash
# 后端
cd backend
npm install

# 前端（如果使用Vue项目）
# 前端静态文件可以直接使用样式预览目录
```

### 2. 启动后端

```bash
cd backend
npm start
# 或开发模式
npm run dev
```

后端会运行在 `http://localhost:3000`

### 3. 启动前端

#### 方式A：直接打开HTML文件
- 打开 `样式预览/index.html`
- 注意：需要修改 `script.js` 中的 `API_BASE_URL`

#### 方式B：使用本地服务器（推荐）

```bash
# 使用Python（如果已安装）
cd 样式预览
python -m http.server 8080

# 或使用Node.js的http-server
npm install -g http-server
cd 样式预览
http-server -p 8080
```

### 4. 访问

- 前端：`http://localhost:8080`
- 后端API：`http://localhost:3000/api`

## 📝 部署配置

### 后端环境变量

创建 `backend/.env` 文件（可选）：

```env
PORT=3000
NODE_ENV=production
```

### 前端配置

在 `样式预览/script.js` 中修改API地址：

```javascript
// 开发环境
const API_BASE_URL = 'http://localhost:3000/api';

// 生产环境（部署后）
const API_BASE_URL = 'https://your-backend-url.onrender.com/api';
```

## 🔧 常见问题

### 1. CORS错误

如果前端和后端不在同一域名，需要配置CORS。后端已经配置了：

```javascript
app.use(cors());
```

### 2. 文件上传失败

- 检查文件大小限制（默认50MB）
- 检查文件类型是否支持
- 检查服务器存储空间

### 3. 数据库错误

- SQLite数据库文件会自动创建在 `backend/database.db`
- 确保有写入权限

### 4. 静态文件无法访问

- 确保 `backend/uploads` 目录存在
- 检查后端路由配置

## 💰 免费额度说明

### Railway
- 免费额度：$5/月
- 适合小型应用

### Render
- 免费额度：750小时/月
- 服务休眠后首次请求较慢

### Vercel
- 前端部署：完全免费
- 无限流量

### 云存储（后期升级）

如果需要云存储，推荐：

1. **阿里云OSS**
   - 按量付费，约0.12元/GB/月
   - 免费额度：无

2. **腾讯云COS**
   - 按量付费，约0.118元/GB/月
   - 免费额度：50GB/6个月

3. **七牛云**
   - 免费额度：10GB存储空间

## 🎯 推荐部署流程

1. **开发阶段**：本地运行
2. **测试阶段**：使用ngrok或Cloudflare Tunnel
3. **生产阶段**：使用Vercel + Render（完全免费）

## 📞 需要帮助？

如果部署遇到问题，可以：
1. 查看服务器日志
2. 检查网络连接
3. 确认环境变量配置
4. 查看本文档的常见问题部分

---

**下一步**：完成本地测试后，选择适合的部署方案进行部署。

