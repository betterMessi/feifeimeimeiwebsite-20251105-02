# 详细部署教程 - 前后端完整指南

## 📌 关于域名

**重要说明**：在Vercel和Render上部署**不会影响**你后续申请域名！

- ✅ **Vercel**：完全支持自定义域名，免费
- ✅ **Render**：完全支持自定义域名，免费
- ✅ 你可以随时添加自己的域名（如：`www.yourname.com`）
- ✅ 部署平台提供的默认域名（如：`xxx.vercel.app`）可以继续使用

**建议**：
1. 先用默认域名部署和测试
2. 后续再购买域名并绑定（不影响现有功能）

---

## 🎯 部署架构

```
前端（Vercel） → 后端（Render） → 数据库（SQLite，在Render上）
```

---

## 第一部分：部署后端到 Render

### 步骤1：准备代码

确保你的代码已经提交到GitHub：

```bash
# 如果还没有GitHub仓库
git init
git add .
git commit -m "Initial commit"
git branch -M main
git remote add origin https://github.com/你的用户名/你的仓库名.git
git push -u origin main
```

### 步骤2：注册Render账号

1. 访问 https://render.com
2. 点击右上角 "Get Started for Free"
3. 选择 "Sign up with GitHub"
4. 授权GitHub账号

### 步骤3：创建Web服务

1. 登录Render后，点击 "New +" → "Web Service"
2. 选择 "Connect account"（连接GitHub）
3. 如果还没有连接，点击 "Connect GitHub"
4. 授权访问仓库
5. 选择你的仓库

### 步骤4：配置服务

填写以下信息：

- **Name**: `photo-sharing-backend`（或你喜欢的名字）
- **Region**: 选择离你最近的地区（如：Singapore）
- **Branch**: `main`（或你的主分支）
- **Root Directory**: `backend`（重要！）
- **Environment**: `Node`
- **Build Command**: `npm install`
- **Start Command**: `npm start`
- **Plan**: 选择 **Free**（免费）

### 步骤5：环境变量设置

在 "Environment Variables" 部分添加：

```
NODE_ENV=production
PORT=10000
```

**注意**：Render的免费服务使用随机端口，但可以通过环境变量`PORT`指定。

### 步骤6：部署

1. 点击 "Create Web Service"
2. Render会自动开始构建和部署
3. 等待部署完成（约5-10分钟）
4. 部署成功后，你会看到：
   - **URL**: `https://photo-sharing-backend.onrender.com`（类似这样）
   - 保存这个URL，后续要用

### 步骤7：测试后端

1. 在浏览器访问：`https://your-backend-url.onrender.com/api/health`
2. 应该返回：`{"status":"ok","message":"服务器运行正常"}`

### 步骤8：处理Render免费服务的休眠问题

**问题**：Render免费服务15分钟无活动会自动休眠，首次访问需要等待约30秒唤醒。

**解决方案**：
1. **使用UptimeRobot（免费）**：定期ping你的服务，保持活跃
   - 访问 https://uptimerobot.com
   - 注册账号
   - 添加监控：选择HTTP(s)，输入你的后端URL
   - 设置间隔：5分钟

2. **或升级到付费计划**（$7/月）：24小时运行，不休眠

---

## 第二部分：部署前端到 Vercel

### 步骤1：注册Vercel账号

1. 访问 https://vercel.com
2. 点击 "Sign Up"
3. 选择 "Continue with GitHub"
4. 授权GitHub账号

### 步骤2：导入项目

1. 登录后，点击 "Add New..." → "Project"
2. 在 "Import Git Repository" 中，选择你的仓库
3. 点击 "Import"

### 步骤3：配置项目

填写以下信息：

- **Project Name**: `photo-sharing-frontend`（或你喜欢的名字）
- **Framework Preset**: 选择 **"Other"**（因为这是静态HTML）
- **Root Directory**: 点击 "Edit"，输入 `样式预览`
- **Build Command**: （留空，因为是静态文件）
- **Output Directory**: `.`（当前目录）
- **Install Command**: （留空）

### 步骤4：设置环境变量

在 "Environment Variables" 部分添加：

```
VITE_API_BASE_URL=https://your-backend-url.onrender.com/api
```

**重要**：将 `your-backend-url.onrender.com` 替换为你刚才从Render获得的后端URL。

### 步骤5：部署

1. 点击 "Deploy"
2. Vercel会自动开始部署
3. 等待部署完成（约1-2分钟）
4. 部署成功后，你会看到：
   - **URL**: `https://your-project-name.vercel.app`（类似这样）
   - 保存这个URL

### 步骤6：测试前端

1. 在浏览器访问你的Vercel URL
2. 打开开发者工具（F12），查看Console
3. 检查是否有错误
4. 尝试上传照片，测试功能

---

## 第三部分：更新前端API地址

### 步骤1：修改前端代码

编辑 `样式预览/script.js`，找到这一行：

```javascript
const API_BASE_URL = 'http://localhost:3000/api';
```

修改为：

```javascript
// 根据环境自动选择API地址
const API_BASE_URL = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'
  ? 'http://localhost:3000/api'
  : 'https://your-backend-url.onrender.com/api';
```

**或者更好的方式**：使用环境变量（如果使用Vite）：

```javascript
const API_BASE_URL = import.meta.env.VITE_API_BASE_URL || 'http://localhost:3000/api';
```

### 步骤2：重新部署

1. 提交代码到GitHub：
   ```bash
   git add 样式预览/script.js
   git commit -m "Update API URL for production"
   git push
   ```

2. Vercel会自动检测到更新并重新部署（约1-2分钟）

---

## 第四部分：测试完整功能

### 测试清单

- [ ] 前端页面可以正常打开
- [ ] 登录功能正常
- [ ] 上传照片功能正常
- [ ] 查看照片功能正常
- [ ] 评论功能正常
- [ ] 标签功能正常
- [ ] 备忘录功能正常

### 常见问题排查

#### 问题1：前端无法连接到后端

**检查**：
1. 浏览器控制台（F12）查看错误
2. 确认后端URL是否正确
3. 确认后端服务是否正常运行（访问 `/api/health`）

**解决**：
- 检查CORS配置（后端已配置 `app.use(cors())`）
- 确认环境变量设置正确

#### 问题2：上传照片失败

**检查**：
1. 文件大小是否超过50MB限制
2. 文件类型是否支持
3. 后端日志查看错误

**解决**：
- 检查后端 `uploads` 目录权限
- 确认Render服务有足够存储空间

#### 问题3：Render服务休眠后首次访问慢

**解决**：
- 使用UptimeRobot保持服务活跃
- 或升级到付费计划

---

## 第五部分：后续添加自定义域名（可选）

### Vercel添加域名

1. 在Vercel项目设置中，进入 "Domains"
2. 输入你的域名（如：`www.yourname.com`）
3. 按照提示配置DNS记录
4. 等待DNS生效（通常几分钟到几小时）

### Render添加域名

1. 在Render服务设置中，进入 "Custom Domains"
2. 添加你的域名
3. 按照提示配置DNS记录
4. 等待DNS生效

### 购买域名推荐

- **国内**：
  - 阿里云：https://wanwang.aliyun.com
  - 腾讯云：https://dnspod.cloud.tencent.com
- **国外**：
  - Namecheap：https://www.namecheap.com
  - Google Domains：https://domains.google

---

## 📋 部署检查清单

### 后端（Render）
- [ ] 注册Render账号
- [ ] 创建Web服务
- [ ] 配置Root Directory为 `backend`
- [ ] 设置环境变量
- [ ] 部署成功
- [ ] 测试 `/api/health` 接口
- [ ] 配置UptimeRobot（可选）

### 前端（Vercel）
- [ ] 注册Vercel账号
- [ ] 导入GitHub仓库
- [ ] 配置Root Directory为 `样式预览`
- [ ] 设置环境变量 `VITE_API_BASE_URL`
- [ ] 部署成功
- [ ] 测试所有功能
- [ ] 修改前端API地址（如果需要）

### 测试
- [ ] 前端页面正常显示
- [ ] 登录功能正常
- [ ] 上传照片正常
- [ ] 查看照片正常
- [ ] 评论功能正常
- [ ] 标签功能正常

---

## 🎉 部署完成！

现在你的应用已经可以在互联网上访问了！

- **前端地址**：`https://your-project.vercel.app`
- **后端地址**：`https://your-backend.onrender.com`

---

## 💡 提示

1. **保存重要信息**：
   - 后端URL
   - 前端URL
   - Render和Vercel的登录信息

2. **监控服务**：
   - 使用UptimeRobot监控后端服务
   - 定期检查服务状态

3. **备份数据**：
   - 定期备份数据库
   - 考虑使用外部数据库（如MongoDB Atlas免费版）

---

## 🆘 需要帮助？

如果遇到问题：
1. 查看部署日志
2. 检查环境变量配置
3. 查看浏览器控制台错误
4. 检查网络连接

---

**下一步**：完成部署后，可以开始集成云存储服务！




